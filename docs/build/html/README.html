

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Installation/Usage: &mdash; nPDyn 1.0 documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
        <script type="text/javascript" src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> nPDyn
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <!-- Local TOC -->
              <div class="local-toc"><ul>
<li><a class="reference internal" href="#">Installation/Usage:</a><ul>
<li><a class="reference internal" href="#unix-and-windows">Unix and Windows</a></li>
</ul>
</li>
<li><a class="reference internal" href="#use-with-ipython">Use with ipython</a></li>
<li><a class="reference internal" href="#usage">Usage</a><ul>
<li><a class="reference internal" href="#import-data-and-pre-processing">Import data and pre-processing</a></li>
<li><a class="reference internal" href="#assign-model-and-fitting">Assign model and fitting</a></li>
<li><a class="reference internal" href="#plotting-data">Plotting data</a></li>
<li><a class="reference internal" href="#examples-of-plotting-window">Examples of plotting window:</a></li>
</ul>
</li>
</ul>
</div>
            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">nPDyn</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Installation/Usage:</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/README.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <p>Work still ongoing, not all features might be fully functional or present at the moment.</p>
<div class="section" id="installation-usage">
<h1>Installation/Usage:<a class="headerlink" href="#installation-usage" title="Permalink to this headline">¶</a></h1>
<p>nPDyn can make use of NAMDAnalyzer, which can be obtained at github.com/kpounot/NAMDAnalyzer</p>
<p>Prior to building, the path to Gnu Scientific Library (GSL) should be given in setup.cfg file
(required by libabsco)</p>
<p>If not, the package can still be installed but paalman-ping corrections won’t work</p>
<div class="section" id="unix-and-windows">
<h2>Unix and Windows<a class="headerlink" href="#unix-and-windows" title="Permalink to this headline">¶</a></h2>
<p>For installation within your python framework, use:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">make</span>
<span class="n">make</span> <span class="n">install</span>
</pre></div>
</div>
<p>or</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">build</span>
<span class="n">python</span> <span class="n">setup</span><span class="o">.</span><span class="n">py</span> <span class="n">install</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="use-with-ipython">
<h1>Use with ipython<a class="headerlink" href="#use-with-ipython" title="Permalink to this headline">¶</a></h1>
<p>The package can be directly imported in python or a session can be started with IPython using the following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">ipython</span> <span class="o">-</span><span class="n">i</span> <span class="o">&lt;</span><span class="n">npdyn</span> <span class="n">__main__</span> <span class="n">path</span><span class="o">&gt;</span> <span class="o">--</span> <span class="p">[</span><span class="n">kwargs</span><span class="p">]</span>
</pre></div>
</div>
<p>This can be used when python or ipython is called within the folder where __main__ is located.</p>
<dl class="simple">
<dt>Options:</dt><dd><ul class="simple">
<li><p>-q, –QENS,                 - import a list of QENS data files</p></li>
<li><p>-f, –FWS,                  - import a list of FWS data files</p></li>
<li><p>-tr, –TempRamp,            - import a list of temperature remp elastic data files</p></li>
<li><p>-res, –resolution,         - import a list of resolution function data files</p></li>
<li><p>-ec, –empty-cell,          - import an empty cell data file</p></li>
<li><p>-fec, –fixed-empty-cell,   - import fixed-window empty cell measurement</p></li>
<li><p>-tec, –TempRamp-empty-cell - import temperature ramp elastic empty cell measurement</p></li>
<li><p>-d, –D2O,                  - import a D2O signal data file</p></li>
<li><p>-fd, –fixed-D2O,           - import a fixed-window D2O signal data file</p></li>
</ul>
</dd>
</dl>
<p>Starting the API using this method creates a instance of Dataset class in a variable called ‘data’.</p>
</div>
<div class="section" id="usage">
<h1>Usage<a class="headerlink" href="#usage" title="Permalink to this headline">¶</a></h1>
<div class="section" id="import-data-and-pre-processing">
<h2>Import data and pre-processing<a class="headerlink" href="#import-data-and-pre-processing" title="Permalink to this headline">¶</a></h2>
<p>For files in hdf5 format, they should be pre-processed using Mantid first - especially for
unmirroring - as the methods for that are not implemented yet.
The same for data coming from MLZ, .y08 or .inx file format, generated by SLAW software, are used.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nPDyn.Dataset</span> <span class="kn">import</span> <span class="n">Dataset</span> <span class="k">as</span> <span class="n">npd</span>


<span class="c1">#_Import QENS file with resolution and empty cell measurements</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">npd</span><span class="p">(</span> <span class="n">QENSFiles</span> <span class="o">=</span> <span class="s1">&#39;firstFile.inx secondFile.nxs thirdFile.inx&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span>
         <span class="n">resFiles</span>  <span class="o">=</span> <span class="s1">&#39;firstRes.inx secondRes.nxs thirdRes.inx&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span>
         <span class="n">ECFile</span>    <span class="o">=</span> <span class="s1">&#39;ecFile.inx&#39;</span> <span class="p">)</span>

<span class="c1">#_Import fixed-window scans files, along with resolution and empty cell (either QENS or fixed-window)</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">npd</span><span class="p">(</span> <span class="n">FWSFiles</span> <span class="o">=</span> <span class="s1">&#39;myFile.nxs&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">(),</span>
         <span class="p">[</span><span class="n">ECFile</span><span class="o">=</span> <span class="ow">or</span> <span class="n">fECFile</span><span class="o">=</span><span class="p">]</span> <span class="s1">&#39;ecFile.nxs&#39;</span><span class="p">,</span>
         <span class="n">resFile</span> <span class="o">=</span> <span class="s1">&#39;resFile.nxs&#39;</span> <span class="p">)</span>

<span class="c1">#_Import temperature ramp elastic measurement</span>
<span class="n">d</span> <span class="o">=</span> <span class="n">npd</span><span class="p">(</span> <span class="n">TempRampFiles</span> <span class="o">=</span> <span class="s1">&#39;firstFile.inx secondFile.inx&#39;</span><span class="o">.</span><span class="n">split</span><span class="p">()</span> <span class="p">)</span>
</pre></div>
</div>
<p>For resolution function, the default behavior is to fit the data using a pseudo-Voigt model, but each
resolution measurement can be fitted individually using provided or user-provided models.
Then, resolution data can be assigned individually to each dataset (QENS, TempRamp or FWS).
By default, if only one resolution file is given, it is assigned to each experimental dataset,
if the number of resolution files equals the number of experimental dataset, resolution data are
assigned to each dataset in the same order they were given. If none applies, nothing is done automatically.</p>
<p>Several data treatment can be performed, including binning, normalization, absorption correction or
empty cell substraction.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">nPDyn.Dataset</span> <span class="kn">import</span> <span class="n">Dataset</span> <span class="k">as</span> <span class="n">npd</span>

<span class="c1">#_Files importation</span>

<span class="c1">#_Experimental dataset are located in d.dataSetList, other attributes as resData, ECData or D2OData</span>
<span class="c1">#_allows to directly access the experimental data</span>

<span class="c1">#_To show first dataset attributes</span>
<span class="n">d</span><span class="o">.</span><span class="n">dataSetList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">X</span>
<span class="n">d</span><span class="o">.</span><span class="n">dataSetList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">intensities</span> <span class="p">(</span><span class="n">detectors</span> <span class="n">row</span><span class="o">-</span><span class="n">wise</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">dataSetList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">errors</span> <span class="p">(</span><span class="n">detectors</span> <span class="n">row</span><span class="o">-</span><span class="n">wise</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">dataSetList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">qVals</span>
<span class="n">d</span><span class="o">.</span><span class="n">dataSetList</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">data</span><span class="o">.</span><span class="n">qIdx</span> <span class="c1">#_This one gives the indices of q-values that are kept for fitting and plotting</span>

<span class="c1">#_To bin all dataset at once with a bin size of 5</span>
<span class="n">d</span><span class="o">.</span><span class="n">binAll</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>

<span class="c1">#_To bin a subset of loaded datasets</span>
<span class="n">d</span><span class="o">.</span><span class="n">binDataSet</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">)</span> <span class="c1">#_First argument is bin size, then a list of dataset indices in d.dataSetList</span>

<span class="n">d</span><span class="o">.</span><span class="n">binResData</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span> <span class="c1">#_For resolution data binning</span>


<span class="c1">#_To normalize data using resolution function scale factor from provided models</span>
<span class="n">d</span><span class="o">.</span><span class="n">normalize_usingResFunc</span><span class="p">(</span> <span class="p">[</span><span class="n">dataset</span> <span class="n">index</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">all</span> <span class="n">dataset</span> <span class="k">if</span> <span class="bp">None</span><span class="p">]</span> <span class="p">)</span>

<span class="c1">#_To normalize temperature ramp data using given number of low temperature points (should be first ones)</span>
<span class="n">d</span><span class="o">.</span><span class="n">normalize_ENS_usingLowTemp</span><span class="p">(</span> <span class="p">[</span><span class="n">dataset</span> <span class="n">index</span> <span class="nb">list</span><span class="p">,</span> <span class="nb">all</span> <span class="n">dataset</span> <span class="k">if</span> <span class="bp">None</span><span class="p">],</span> <span class="n">nbrBins</span><span class="o">=</span><span class="mi">8</span><span class="p">)</span>


<span class="c1">#_To perform absorption corrections, if D2O and res are True, absorption correction are performed on loaded</span>
<span class="c1">#_resolution and D2O data too. canType can be &#39;tube&#39; or &#39;slab&#39;.</span>
<span class="c1">#_The method is simply a python wrapper for Joachim Wuttke&#39;s C code libabsco:</span>
<span class="c1">#_see http://apps.jcns.fz-juelich.de/doku/sc/absco</span>
<span class="n">d</span><span class="o">.</span><span class="n">absorptionCorrection</span><span class="p">(</span><span class="o">*</span><span class="n">fileIdxList</span><span class="p">,</span> <span class="n">canType</span><span class="o">=</span><span class="s1">&#39;tube&#39;</span><span class="p">,</span> <span class="n">canScaling</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span>
                            <span class="n">neutron_wavelength</span><span class="o">=</span><span class="mf">6.27</span><span class="p">,</span> <span class="n">absco_kwargs</span><span class="o">=</span><span class="p">{},</span> <span class="n">D2O</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">res</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>


<span class="c1">#_To perform empty cell substraction, using a scale factor of 0.95 and empty cell data</span>
<span class="n">d</span><span class="o">.</span><span class="n">substract_EC</span><span class="p">(</span><span class="o">*</span><span class="n">fileIdxList</span><span class="p">,</span> <span class="n">subFactor</span><span class="o">=</span><span class="mf">0.95</span><span class="p">,</span> <span class="n">subD2O</span><span class="o">=</span><span class="bp">True</span><span class="p">,</span> <span class="n">subRes</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>


<span class="c1">#_To discard specific detectors using their indices in d.dataSetList[i].data.qIdx</span>
<span class="n">d</span><span class="o">.</span><span class="n">discardDetectors</span><span class="p">(</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">12</span><span class="p">,</span> <span class="mi">13</span><span class="p">],</span> <span class="o">*</span><span class="n">fileIdxList</span><span class="p">):</span>

<span class="c1">#_To set the q-range used for fitting and plotting</span>
<span class="n">d</span><span class="o">.</span><span class="n">setQRange</span><span class="p">(</span><span class="mf">0.2</span><span class="p">,</span> <span class="mf">1.6</span><span class="p">,</span> <span class="o">*</span><span class="n">fileIdxList</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="assign-model-and-fitting">
<h2>Assign model and fitting<a class="headerlink" href="#assign-model-and-fitting" title="Permalink to this headline">¶</a></h2>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#_Importation and pre-processing</span>

<span class="c1">#_To assign a model to datasets, again if *fileIdxList is not given, all datasets are used</span>
<span class="n">d</span><span class="o">.</span><span class="n">assignModeltoData</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="o">*</span><span class="n">fileIdxList</span><span class="p">)</span>

<span class="c1">#_Various models for FWS, QENS or temperature ramp are provided, but user can defined their own</span>
<span class="c1">#_using the same template as the ones in nPDyn.dataTypes.models</span>
<span class="c1">#_Models are stored in the following</span>

<span class="n">d</span><span class="o">.</span><span class="n">models</span>

<span class="c1">#_Where the first word in the name is the type of data it should bu used with, then if its meant for protein</span>
<span class="c1">#_or water dynamics, then if it is in liquid or powder state, then some properties such as wether there is</span>
<span class="c1">#_one or two Lorentzians, or if the convolution is performed using analytic Voigt profile and finally</span>
<span class="c1">#_the minimization algorithm used. For which, Min is scipy minimize, CF is scipy curve_fit and</span>
<span class="c1">#_BH is scipy basinhopping algorithm.</span>

<span class="c1">#_Then data can be fitted using the following, with p0 allowing to give custom initial parameters,</span>
<span class="c1">#_and bounds allowing to give custom boundaries on parameters.</span>
<span class="c1">#_Argument qWise controls whether the fit is global or q-wise.</span>

<span class="n">d</span><span class="o">.</span><span class="n">fitData</span><span class="p">(</span><span class="o">*</span><span class="n">fileIdxList</span><span class="p">,</span> <span class="n">p0</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">bounds</span><span class="o">=</span><span class="bp">None</span><span class="p">,</span> <span class="n">qWise</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="plotting-data">
<h2>Plotting data<a class="headerlink" href="#plotting-data" title="Permalink to this headline">¶</a></h2>
<p>All dataset can be plotted even within model assigned or fitting having been done. This will just result
is some error messages showing for some plot functions.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1">#_Pre-rocessing and fitting</span>

<span class="c1">#_Various methods are provided for plotting, they are listed in the following</span>

<span class="n">d</span><span class="o">.</span><span class="n">plotResFunc</span><span class="p">()</span>
<span class="n">d</span><span class="o">.</span><span class="n">plotD2OFunc</span><span class="p">()</span>
<span class="n">d</span><span class="o">.</span><span class="n">plotECFunc</span><span class="p">()</span>
<span class="n">d</span><span class="o">.</span><span class="n">plotFWS</span><span class="p">(</span><span class="n">fileIdx</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">plotQENS</span><span class="p">(</span><span class="o">*</span><span class="n">fileIdxList</span><span class="p">)</span>
<span class="n">d</span><span class="o">.</span><span class="n">plotTempRampENS</span><span class="p">(</span><span class="o">*</span><span class="n">fileIdxList</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="section" id="examples-of-plotting-window">
<h2>Examples of plotting window:<a class="headerlink" href="#examples-of-plotting-window" title="Permalink to this headline">¶</a></h2>
<table>
    <tr>
        <td>
            <img src="../fig/tempRamp_01.PNG">
        </td>
        <td>
            <img src="../fig/tempRamp_02.PNG">
        </td>
        <td>
            <img src="../fig/tempRamp_03.PNG">
        </td>
        <td>
            <img src="../fig/qens_01.PNG">
        </td>
        <td>
            <img src="../fig/qens_02.PNG">
        </td>
        <td>
            <img src="../fig/qens_03.PNG">
        </td>
        <td>
            <img src="../fig/fws_01.PNG">
        </td>
        <td>
            <img src="../fig/fws_02.PNG">
        </td>
    </tr>
</table></div>
</div>


           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2019, Kevin Pounot

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>